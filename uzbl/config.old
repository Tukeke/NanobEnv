# === Shortcuts ==============================================================

# request BIND <keycmd> = <command>
set bind           = request BIND
# request MODE_CONFIG <mode> <key> = <value
set mode_config    = request MODE_CONFIG
# request TOGGLE_MODES <mode1> <mode2> ... <moden>
set toggle_modes   = request TOGGLE_MODES
# request ON_EVENT <EVENT_NAME> <command>
set on_event       = request ON_EVENT
# request PROGRESS_CONFIG <key> = <value>
set progress       = request PROGRESS_CONFIG
# request MODMAP From To
set modmap         = request MODMAP
# request IGNORE_KEY <glob>
set ignore_key     = request IGNORE_KEY

set set_mode       = set mode =
set set_status     = set status_message =

# Spawn path shortcuts. In spawn the first dir+path match is used in "dir1:dir2:dir3:executable"
set scripts_dir    = $XDG_DATA_HOME/uzbl:/usr/share/doc/uzbl/examples/data/uzbl/scripts


# === Handlers ===============================================================

set modcmd_style      = weight="bold" foreground="red"
set keycmd_style      = weight="light" foreground="red"
set prompt_style      = foreground="grey"
set cursor_style      = underline="single"

set mode_section      = <span background="khaki" foreground="black">[\@[\@mode_indicator]\@]</span>
set keycmd_section    = [<span \@prompt_style>\@[\@keycmd_prompt]\@</span><span \@modcmd_style>\@modcmd</span><span \@keycmd_style>\@keycmd</span>]
set progress_section  = <span foreground="#606060">\@[\@progress_format]\@</span>
set uri_section       = <span foreground="#99FF66">\@[\@uri]\@</span>
set name_section      = <span foreground="khaki">\@[\@NAME]\@</span>
set status_section    = <span foreground="orange">\@status_message</span>
set selected_section  = <span foreground="#606060">\@[\@SELECTED_URI]\@</span>
set scroll_section    = <span foreground="#606060">\@[\@scroll_message]\@</span>

# This script sets @scroll_message to the scroll position
@on_event   LOAD_COMMIT    script /usr/share/uzbl/examples/data/uzbl/scripts/scroll-percentage.js

# Progress bar config
@progress width    = 8
# %d = done, %p = pending %c = percent done, %i = int done, %s = spinner,
# %t = percent pending, %o = int pending, %r = sprite scroll
@progress format   = [%d>%p]%c
@progress done     = =
@progress pending  =


# === Binding modmaps ========================================================

#modmap from           to
@modmap Control        Ctrl
@modmap ISO_Left_Tab   Shift-Tab
@modmap space          Space

#ignore_key <glob>
@ignore_key <ISO_*>
@ignore_key <Shift>

# === command editing configuration ==========================================

# you'll want this at the very least
@bind <Return>       = event KEYCMD_EXEC_CURRENT
@bind <Escape>       = @set_mode

# basic searching
@bind <Left>         = event SET_CURSOR_POS -
@bind <Right>        = event SET_CURSOR_POS +
@bind <BackSpace>    = event KEYCMD_BACKSPACE
@bind <Delete>       = event KEYCMD_DELETE

# readline-ish bindings
@bind <Ctrl>w      = event KEYCMD_STRIP_WORD
@bind <Ctrl>u      = event SET_KEYCMD
@bind <Ctrl>a      = event SET_CURSOR_POS 0
@bind <Ctrl>e      = event SET_CURSOR_POS -1


# === Context menu items =====================================================

# Default context menu
menu_add Google = set uri = http://google.com
menu_add Go Home = set uri = http://uzbl.org
menu_separator separator_1
menu_add Quit uzbl = exit

# Link context menu
#menu_link_add New instance = sh 'uzbl-browser -u \@SELECTED_URI'
#menu_link_add Print Link = print \@SELECTED_URI


# === Mode configuration =====================================================

# Define some mode specific uzbl configurations.
set command  = @mode_config command
set insert   = @mode_config insert
set stack    = @mode_config stack

# Command mode config.
@command  keycmd_style        = foreground="red"
@command  status_background   = #202020
@command  mode_indicator      = Cmd

# Insert mode config.
@insert   status_background   = #303030
@insert   mode_indicator      = Ins

# Multi-stage-binding mode config.
@stack    keycmd_events       = 1
@stack    modcmd_updates      = 1
@stack    keycmd_style        = foreground="red"
@stack    prompt_style        = foreground="#888" weight="light"
@stack    status_background   = #202020
@stack    mode_indicator      = Bnd


# ----------------------------------------------------------------------------

# Handlers

# New window handler options
set new_window         = sh 'uzbl-browser -u $8' # equivalent to the default behaviour
set download_handler   = spawn $HOME/.config/uzbl/download.sh
set cookie_handler     = talk_to_socket $XDG_CACHE_HOME/uzbl/cookie_daemon_socket
#Could be used for handling non-http:// links
#set scheme_handler     = sync_spawn @scripts_dir/scheme.py

@on_event   LOAD_START     @set_status <span foreground="red">wait</span>
@on_event   LOAD_COMMIT    @set_status <span foreground="gold">recv</span>
@on_event   LOAD_FINISH    @set_status <span foreground="green">done</span>

# Generate a FORM_ACTIVE event if an editable
# element on the loaded site has initial focus
@on_event   LOAD_FINISH    js if(document.activeElement.type == 'text') {Uzbl.run("event FORM_ACTIVE");}
# Switch to insert mode if a (editable) html form is clicked
@on_event   FORM_ACTIVE    @set_mode insert
# Switch to command mode if anything else is clicked
@on_event   ROOT_ACTIVE    @set_mode command

# Behaviour and appearance
set show_status       = 1
set status_background = #3f3f3f
set status_format     = <span font_family="monospace">@mode_section @keycmd_section @progress_section @selected_section @uri_section @name_section @status_section @scroll_section</span>
set status_top        = 0
set useragent         = Uzbl (Webkit @WEBKIT_MAJOR.@WEBKIT_MINOR.@WEBKIT_MICRO) (@(uname -o)@ @(uname -m)@ [@ARCH_UZBL]) (Commit @COMMIT)

set fifo_dir          = /tmp
set socket_dir        = /tmp
set shell_cmd         = sh -c


# Keyboard interface
#set modkey = Mod1
# like this you can enter any command at runtime, interactively. prefixed by ':'
@bind    :_        = chain '%s'

# Examples using multi-stage-bindings with text prompts.
#@bind g<google:>_        = uri https://ssl.scroogle.org/cgi-bin/nbbwssl.cgi?Gw=%s
#@bind o<uri:>_ = uri %s
@bind o<uri:>_ = script /home/psychon/.config/uzbl/open.js '%s'
@bind O<uri:\@uri>_ = uri %s



@bind    j         = scroll vertical 20
@bind    k         = scroll vertical -20
@bind    h         = scroll horizontal -20
@bind    l         = scroll horizontal 20
@bind    gg        = scroll vertical begin
@bind    G         = scroll vertical end
@bind    <Page_Up>   = scroll vertical -95%
@bind    <Page_Down> = scroll vertical 95%
@bind    <Home>      = scroll vertical begin
@bind    <End>       = scroll vertical end

@bind    b         = back
@bind    m         = forward
@bind    S         = stop
@bind    r         = reload
@bind    R         = reload_ign_cache
@bind    +         = zoom_in
@bind    -         = zoom_out
@bind    z         = toggle_zoom_type
@bind    1         = sh "echo set zoom_level = 1.0 > $4"
@bind    2         = sh "echo set zoom_level = 2.0 > $4"
@bind    T         = toggle_status
@bind    /*        = search %s
@bind    ?*        = search_reverse %s
#jump to next
@bind    n         = search
@bind    N         = search_reverse
@bind    i         = toggle_insert_mode
# disable insert mode (1 to enable).  note that Esc works to disable, regardless of this setting
@bind    I         = toggle_insert_mode 0

# Copy current page
@bind    y         = sh 'echo -n $6 | xsel -i'
@bind    Y         = sh 'echo -n $6 | xsel -i --clipboard'
# go to the page from the selection
@bind    p         = sh 'echo "uri `xsel -o | sed s/\\\@/%40/g`" > $4'
@bind    P         = sh 'echo "uri `xsel -o --clipboard | sed s/\\\@/%40/g`" > $4'
# start a new uzbl instance from the page in primary selection
@bind    'p        = sh 'exec uzbl --uri $(xsel -o | sed s/\@/%40/g)'
@bind    d         = exit

@bind    f*       = script /usr/share/uzbl/examples/data/scripts/follow.js '0123456789 %s'

# Inject handy values into the keycmd.
@bind <Ctrl>su = event INJECT_KEYCMD \@uri
@bind <Ctrl>st = event INJECT_KEYCMD \@TITLE
# Or append.
@bind <Ctrl>du = event APPEND_KEYCMD \@uri
@bind <Ctrl>dt = event APPEND_KEYCMD \@TITLE

set default_mode = command

# Mode bindings:
set toggle_cmd_ins = @toggle_modes command insert
@bind I        = @set_mode insert
@bind i        = @toggle_cmd_ins
@bind <Ctrl>i  = @toggle_cmd_ins


# "home" page if you will
set uri = uzbl.org
